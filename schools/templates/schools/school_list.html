{% load leaflet_tags %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'schools/style.css' %}">
{% leaflet_css %}
{% leaflet_js %}

<div>
    <h1 class="app-title">Primary schools in Singapore</h1>
    <div class="map-container">
        {% leaflet_map "mainmap" callback="map_init" %}
    </div>
</div>

<script type="text/javascript">

    function map_init(map, options) {
        //set map map.setMaxBounds
        map.setMaxBounds( [[1.1,103.5], [1.5,104.2]] );
        //create markers group
        var markers = L.layerGroup();

        {% for school in primary_school_list %}
            var lon = "{{ school.geometry.x }}";
            var lat = "{{ school.geometry.y }}";
            // add a marker to markers
            var marker = L.marker([lat, lon]).bindPopup('This is {{ school.name }}');
            markers.addLayer(marker);
        {% endfor %}

        //add markers group to map
        map.addLayer(markers);

        map.setView([1.32, 103.83], 12);

        //alert mouse location on click
        map.addEventListener('click', function(ev) {
            var lat, lng;
            lat = ev.latlng.lat;
            lng = ev.latlng.lng;
            alert(lat + ' - ' + lng);
            markers.clearLayers();
            marker = L.marker([lat, lng]);
            markers.addLayer(marker);
        });

    }

</script>
